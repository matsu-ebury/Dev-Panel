<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBA Development Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%234f46e5'/%3E%3Ctext x='50%25' y='56%25' text-anchor='middle' font-size='40' font-family='Arial, sans-serif' fill='white'%3EE%3C/text%3E%3C/svg%3E" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%; /* Adjusted for wider charts */
            margin-left: auto;
            margin-right: auto;
            height: 400px; /* Base height for charts */
        }
        @media (min-width: 640px) {
            .chart-container {
                height: 400px; /* Consistent height on larger screens */
            }
        }
        .nav-button {
            transition: all 0.2s ease;
            position: relative;
            top: 1px;
        }
        .nav-button.active {
            background-color: white;
            color: #4f46e5;
            border-color: #e2e8f0;
            border-bottom-color: transparent;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            z-index: 10;
        }
        .nav-button:not(.active):hover {
            background-color: #f1f5f9;
            color: #1a202c;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .icon-card {
            font-size: 2.25rem;
            color: #4f46e5;
            margin-bottom: 1rem;
        }
        .metric-icon {
            font-size: 3rem;
            color: #0c2b68; 
            margin-bottom: 1rem;
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 9999px;
            height: 0.625rem;
        }
        .progress-bar {
            background-color: #6366f1;
            height: 0.625rem;
            border-radius: 9999px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">

        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-indigo-700">DBA Development Panel <i class="fas fa-chart-line ml-2"></i></h1>
            <p class="text-slate-500 mt-2 text-lg">An interactive summary of our achievements, metrics, and learnings.</p>
        </header>

        <nav id="main-nav" class="flex justify-center gap-0 mb-8 border-b border-slate-200">
            <div class="flex justify-start gap-0 w-full bg-slate-100 rounded-t-xl p-1 shadow-sm">
                <button data-target="release" class="nav-button active font-semibold py-2 px-8 border border-b-0 border-transparent text-slate-600 hover:bg-white hover:text-indigo-700 rounded-t-xl transition-all duration-200 flex items-center gap-2">
                    <i class="fas fa-rocket"></i> Release Dashboard
                </button>
                <button data-target="overview" class="nav-button font-semibold py-2 px-8 border border-b-0 border-transparent text-slate-600 hover:bg-white hover:text-indigo-700 rounded-t-xl transition-all duration-200 flex items-center gap-2">
                    <i class="fas fa-chart-bar"></i> Last 6W
                </button>
                <button data-target="history" class="nav-button font-semibold py-2 px-8 border border-b-0 border-transparent text-slate-600 hover:bg-white hover:text-indigo-700 rounded-t-xl transition-all duration-200 flex items-center gap-2">
                    <i class="fas fa-history"></i> Sprint History
                </button>
            </div>
        </nav>
        <main>
            <section id="release" class="content-section active">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Release Dashboard <i class="fas fa-rocket ml-2 text-indigo-600"></i></h2>
                    <p class="text-slate-600">
                        The Release Dashboard provides a comprehensive view of our team's recent delivery performance, highlighting completed epics, ongoing work, and overall progress. Here you can track story points, monitor burndown trends, and review key metrics that reflect our efficiency and impact over the last six weeks.
                    </p>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-6 mt-8">
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-list-check"></i>
                        <p class="text-3xl font-bold text-teal-600">3</p>
                        <p class="text-slate-500">Epics Delivered</p>
                    </div>
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-star"></i>
                        <p class="text-3xl font-bold text-indigo-600">3</p>
                        <p class="text-slate-500">Epics in Progress</p>
                    </div>
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-users"></i>
                        <p class="text-3xl font-bold text-teal-600">210</p>
                        <p class="text-slate-500">Overall Story Points</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm flex flex-col items-center col-span-2 md:col-span-3">
                        <h3 class="text-lg font-bold text-slate-900 mb-2 flex items-center gap-2">
                            <i class="fas fa-fire text-indigo-600"></i> Burndown Chart
                        </h3>
                        <div class="chart-container" style="width: 100%; max-width: 100%; height: 400px;">
                            <canvas id="burndownChart" style="width:100% !important; height:400px !important;"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            <section id="overview" class="content-section">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">6-Week Overview <i class="fa-solid fa-magnifying-glass ml-2 text-indigo-600"></i></h2>
                    <p class="text-slate-600">The last 6 weeks were focused on innovation, stability, and improving the customer experience. We achieved important milestones that had a direct impact on the business and strengthened our technology platform. This section summarizes our main results.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-indigo-500 flex flex-col items-start justify-between">
                        <div>
                            <i class="icon-card fas fa-hand-holding-usd"></i>
                            <h3 class="font-bold text-xl mb-2 text-slate-900">UX Improvements - Withdraw</h3>
                            <p class="text-slate-600">We implemented UX improvements in the transfer flow, making the process more intuitive, faster, and transparent for the user. The changes reduced unnecessary steps, simplified messages, and increased the clarity of the information displayed, resulting in fewer questions and greater customer satisfaction.</p>
                        </div>
                        <div class="mt-4 w-full">
                            <p class="text-slate-700 font-semibold text-lg">User Stories: <span class="text-indigo-600">18</span></p>
                            <p class="text-slate-700 font-semibold text-lg">Story Points: <span class="text-indigo-600">63</span></p>
                            <div class="progress-bar-container mt-2">
                                <div class="progress-bar" data-progress="80" style="width: 80%"></div>
                            </div>
                            <span class="text-xs text-slate-400 mt-1">80% completed</span>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-teal-500 flex flex-col items-start justify-between">
                        <div>
                            <i class="icon-card fas fa-chart-pie"></i>
                            <h3 class="font-bold text-xl mb-2 text-slate-900">UX Improvements Settlement</h3>
                            <p class="text-slate-600">We enhanced the user experience in settlement reports, making navigation clearer and more intuitive. Financial information was reorganized for easier understanding, dynamic filters were added, and data visualization was improved, reducing queries and accelerating decision-making.</p>
                        </div>
                        <div class="mt-4 w-full">
                            <p class="text-slate-700 font-semibold text-lg">User Stories: <span class="text-teal-600">22</span></p>
                            <p class="text-slate-700 font-semibold text-lg">Story Points: <span class="text-teal-600">95</span></p>
                            <div class="progress-bar-container mt-2">
                                <div class="progress-bar bg-teal-500" data-progress="100" style="width: 100%"></div>
                            </div>
                            <span class="text-xs text-slate-400 mt-1">100% completed</span>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-amber-500 flex flex-col items-start justify-between">
                        <div>
                            <i class="icon-card fas fa-globe-americas"></i>
                            <h3 class="font-bold text-xl mb-2 text-slate-900">Non Resident's Accounts </h3>
                            <p class="text-slate-600">We adjusted transfer and account management flows to accommodate Non-Resident Account functionalities.</p>
                        </div>
                        <div class="mt-4 w-full">
                            <p class="text-slate-700 font-semibold text-lg">User Stories: <span class="text-amber-600">20</span></p>
                            <p class="text-slate-700 font-semibold text-lg">Story Points: <span class="text-amber-600">98</span></p>
                            <div class="progress-bar-container mt-2">
                                <div class="progress-bar bg-amber-500" data-progress="90" style="width: 90%"></div>
                            </div>
                            <span class="text-xs text-slate-400 mt-1">90% completed</span>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-indigo-500 flex flex-col items-start justify-between">
                        <div>
                            <i class="icon-card fas fa-receipt"></i>
                            <h3 class="font-bold text-xl mb-2 text-slate-900">Transfer Receipts</h3>
                            <p class="text-slate-600">Development of transfer receipts, providing a support tool for operations.</p>
                        </div>
                        <div class="mt-4 w-full">
                            <p class="text-slate-700 font-semibold text-lg">User Stories: <span class="text-indigo-600">4</span></p>
                            <p class="text-slate-700 font-semibold text-lg">Story Points: <span class="text-indigo-600">20</span></p>
                            <div class="progress-bar-container mt-2">
                                <div class="progress-bar" data-progress="100" style="width: 100%"></div>
                            </div>
                            <span class="text-xs text-slate-400 mt-1">100% completed</span>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-teal-500 flex flex-col items-start justify-between">
                        <div>
                            <i class="icon-card fas fa-book"></i>
                            <h3 class="font-bold text-xl mb-2 text-slate-900">API Documentation in Open API</h3>
                            <p class="text-slate-600">Mapping and documentation of all internal and external APIs in Open API.</p>
                        </div>
                        <div class="mt-4 w-full">
                            <p class="text-slate-700 font-semibold text-lg">User Stories: <span class="text-teal-600">10</span></p>
                            <p class="text-slate-700 font-semibold text-lg">Story Points: <span class="text-teal-600">34</span></p>
                            <div class="progress-bar-container mt-2">
                                <div class="progress-bar bg-teal-500" data-progress="70" style="width: 70%"></div>
                            </div>
                            <span class="text-xs text-slate-400 mt-1">70% completed</span>
                        </div>
                    </div>
                </div>

                <div class="my-6"></div>

                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Some deliverables <i class="fas fa-rocket ml-2 text-indigo-600"></i></h2>
                    <p class="text-slate-600">Some features that we've been working.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <article class="bg-white p-6 rounded-xl shadow-sm flex flex-col items-center text-center">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-file-code text-3xl text-indigo-600 mr-3"></i>
                            <h3 class="font-bold text-xl text-indigo-600">API Documentation in Open API</h3>
                        </div>
                        <img src="assets/docs.png" alt="Swagger" class="mx-auto rounded-lg shadow mt-4 w-full h-auto max-w-xs object-contain">
                    </article>
                    <article class="bg-white p-6 rounded-xl shadow-sm flex flex-col items-center text-center">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-file-invoice-dollar text-3xl text-indigo-600 mr-3"></i>
                            <h3 class="font-bold text-xl text-indigo-600">Transfer Receipts</h3>
                        </div>
                        <div class="flex flex-row flex-wrap justify-center gap-4 mt-4 w-full">
                            <img src="assets/comprovante.png" alt="Digital receipt example" class="rounded-lg shadow w-full max-w-[220px] h-auto object-contain">
                            <img src="assets/comprovante2.png" alt="Digital receipt example" class="rounded-lg shadow w-full max-w-[220px] h-auto object-contain">
                        </div>
                    </article>
                    <article class="bg-white p-6 rounded-xl shadow-sm flex flex-col items-center text-center md:col-span-2">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-chart-area text-3xl text-indigo-600 mr-3"></i>
                            <h3 class="font-bold text-xl text-indigo-600">Settlement Experience Improvements</h3>
                        </div>
                        <img src="assets/settlement.png" alt="Settlement screen" class="mx-auto rounded-lg shadow mt-4 w-full h-auto max-w-md object-contain">
                    </article>
                </div>

                <div class="my-6"></div>
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Our Numbers <i class="fas fa-calculator ml-2 text-indigo-600"></i></h2>
                    <p class="text-slate-600">Data tells the story of our progress. In this section, we present the key metrics we monitor to measure our efficiency, the quality of our deliveries, and the direct business impact.</p>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mt-8">
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-list-check"></i>
                        <p class="text-3xl font-bold text-teal-600">4</p>
                        <p class="text-slate-500">Epics</p>
                    </div>
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-star"></i>
                        <p class="text-3xl font-bold text-indigo-600">310</p>
                        <p class="text-slate-500">Total Story Points</p>
                    </div>
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-users"></i>
                        <p class="text-3xl font-bold text-teal-600">4</p>
                        <p class="text-slate-500">FTEs</p>
                    </div>
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-box-open"></i>
                        <p class="text-3xl font-bold text-indigo-600">48</p>
                        <p class="text-slate-500">Support Tasks</p>
                    </div>
                </div>
                <div class="my-6"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm flex flex-col items-center">
                        <h3 class="text-xl font-bold text-center mb-4 text-slate-900">Velocity - Average story points</h3>
                        <div class="chart-container">
                            <canvas id="mttrChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm flex flex-col items-center">
                        <h3 class="text-xl font-bold text-center mb-4 text-slate-900">Build & Run</h3>
                        <div class="chart-container">
                            <canvas id="deploymentsChart_overview"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            <section id="history" class="content-section">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Sprint History <i class="fas fa-history ml-2 text-indigo-600"></i></h2>
                    <p class="text-slate-600">
                        The Sprint History page offers a detailed record of our team's progress across recent sprints. Here you will find an overview of completed work, ongoing initiatives, and key metrics that highlight our achievements and challenges. This section helps visualize our continuous improvement, delivery cadence, and the evolution of our team's performance over time.
                    </p>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm mb-6 flex flex-col items-start">
                    <label for="sprint-select" class="text-lg font-semibold text-slate-800 mb-2">Select Sprint:</label>
                    <select id="sprint-select" class="block w-full max-w-xs p-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </select>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 gap-6 mt-8">
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-tools text-indigo-600"></i>
                        <p class="text-3xl font-bold text-indigo-600" id="build-metric">--</p>
                        <p class="text-slate-500">Build</p>
                    </div>
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-code-branch text-amber-600"></i>
                        <p class="text-3xl font-bold text-amber-600" id="run-metric">--</p>
                        <p class="text-slate-500">Develop</p>
                    </div>
                    <div class="bg-white p-4 text-center rounded-xl shadow-sm flex flex-col justify-center items-center">
                        <i class="metric-icon fas fa-lightbulb text-teal-600"></i>
                        <p class="text-3xl font-bold text-teal-600" id="refine-metric">--</p>
                        <p class="text-slate-500">Refine</p>
                    </div>
                </div>

                <div class="my-8"></div>
                
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6 flex flex-col items-start">
                    <h3 class="text-lg font-bold text-slate-900 mb-2 flex items-center gap-2">
                            <i class="fas fa-tasks text-indigo-600"></i> Epics Status
                    </h3>
                    <div class="chart-container">
                        <canvas id="epicsStatusChart"></canvas>
                    </div>
                </div>

 
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6 flex flex-col items-start">
                    <h3 class="text-lg font-bold text-slate-900 mb-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle text-indigo-600"></i> Run Causes
                    </h3>
                    <div class="chart-container">
                        <canvas id="runCausesChart"></canvas>
                    </div>
                </div>


            </section>
        </main>

        <footer class="text-center mt-12 pt-6 border-t border-slate-200">
            <p class="text-slate-500">&copy; 2025 DBA Team. All rights reserved.</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const nav = document.getElementById('main-nav');
            const sections = document.querySelectorAll('.content-section');
            const buttons = nav.querySelectorAll('button');
            const sprintSelect = document.getElementById('sprint-select');

            let burndownChartInstance = null;
            let mttrChartInstance = null;
            let overviewDeploymentsChartInstance = null;
            let effortDistributionChartInstance = null;
            let epicsStatusChartInstance = null;
            let runCausesChartInstance = null;
            
            // --- Data from sprintData.json is now embedded here ---
            const sprintData = {
              "DBA-2025SP32": {
                  "effort": {"build": 65, "develop": 80, "refine": 20},
                  "epics": {
                      "DBA-101: Reporting Module": {"Done": 5, "Done in Sprint": 5, "Pending": 3, "Dropped": 3},
                      "DBA-102: Auth Flow": {"Done": 3, "Done in Sprint": 8, "Pending": 1, "Dropped": 1},
                      "DBA-112: Non-Resident Acct.": {"Done": 3, "Done in Sprint": 5, "Pending": 2, "Dropped": 1},
                      "DBA-120: New API Specs": {"Done": 8, "Done in Sprint": 13, "Pending": 2, "Dropped": 1},
                      "DBA-121: DB Schema Refactor": {"Done": 6, "Done in Sprint": 2, "Pending": 1, "Dropped": 2}
                  },
                  "run_causes": {"WrongFlow": 10, "ValorMenor": 5, "DepositoFilialMatriz": 8, "SettlementEventDate": 2}
              },
              "DBA-2025SP33": {
                  "effort": {"build": 60, "develop": 90, "refine": 10},
                  "epics": {
                      "DBA-105: API Docs Portal": {"Done": 2, "Done in Sprint": 3, "Pending": 3, "Dropped": 5},
                      "DBA-108: Settlement UX": {"Done": 8, "Done in Sprint": 5, "Pending": 2, "Dropped": 1},
                      "DBA-115: Withdraw UX": {"Done": 13, "Done in Sprint": 1, "Pending": 3, "Dropped": 1},
                      "DBA-110: Transfer Receipts": {"Done": 13, "Done in Sprint": 8, "Pending": 1, "Dropped": 1},
                      "DBA-122: Caching Layer": {"Done": 3, "Done in Sprint": 8, "Pending": 1, "Dropped": 1},
                      "DBA-109: Notification Svc": {"Done": 2, "Done in Sprint": 2, "Pending": 8, "Dropped": 2}
                  },
                  "run_causes": {"WrongFlow": 8, "ValorMenor": 6, "DepositoFilialMatriz": 4, "SettlementEventDate": 5}
              },
              "DBA-2025SP34": {
                  "effort": {"build": 70, "develop": 60, "refine": 40},
                  "epics": {
                      "DBA-121: DB Schema Refactor": {"Done": 1, "Done in Sprint": 0, "Pending": 0, "Dropped": 0},
                      "DBA-120: New API Specs": {"Done": 0, "Done in Sprint": 1, "Pending": 0, "Dropped": 0},
                      "DBA-130: Fraud Detection": {"Done": 0, "Done in Sprint": 0, "Pending": 1, "Dropped": 0},
                      "DBA-131: KYC Process": {"Done": 0, "Done in Sprint": 0, "Pending": 1, "Dropped": 0}
                  },
                  "run_causes": {"WrongFlow": 12, "ValorMenor": 3, "DepositoFilialMatriz": 3, "SettlementEventDate": 1}
              },
              "DBA-2025SP35": {
                  "effort": {"build": 55, "develop": 70, "refine": 30},
                  "epics": {
                      "DBA-122: Caching Layer": {"Done": 1, "Done in Sprint": 0, "Pending": 0, "Dropped": 0},
                      "DBA-131: KYC Process": {"Done": 0, "Done in Sprint": 1, "Pending": 0, "Dropped": 0},
                      "DBA-130: Fraud Detection": {"Done": 0, "Done in Sprint": 0, "Pending": 1, "Dropped": 0},
                      "DBA-140: User Profile Page": {"Done": 0, "Done in Sprint": 0, "Pending": 1, "Dropped": 0}
                  },
                  "run_causes": {"WrongFlow": 7, "ValorMenor": 9, "DepositoFilialMatriz": 6, "SettlementEventDate": 3}
              },
              "DBA-2526SP1": {
                  "effort": {"build": 50, "develop": 40, "refine": 60},
                  "epics": {
                      "DBA-130: Fraud Detection": {"Done": 8, "Done in Sprint": 5, "Pending": 1, "Dropped": 1},
                      "DBA-140: User Profile Page": {"Done": 6, "Done in Sprint": 3, "Pending": 1, "Dropped": 0},
                      "DBA-142: MFA Rollout": {"Done": 6, "Done in Sprint": 3, "Pending": 1, "Dropped": 1},
                      "DBA-145: Analytics Dashboard": {"Done": 10, "Done in Sprint": 5, "Pending": 1, "Dropped": 1},
                      "DBA-135: Gamification PoC": {"Done": 13, "Done in Sprint": 3, "Pending": 1, "Dropped": 1}
                  },
                  "run_causes": {"WrongFlow": 5, "ValorMenor": 4, "DepositoFilialMatriz": 10, "SettlementEventDate": 6}
              }
            };

            function destroyCharts() {
                if (burndownChartInstance) burndownChartInstance.destroy();
                if (mttrChartInstance) mttrChartInstance.destroy();
                if (overviewDeploymentsChartInstance) overviewDeploymentsChartInstance.destroy();
                if (effortDistributionChartInstance) effortDistributionChartInstance.destroy();
                if (epicsStatusChartInstance) epicsStatusChartInstance.destroy();
                if (runCausesChartInstance) runCausesChartInstance.destroy();
                burndownChartInstance = mttrChartInstance = overviewDeploymentsChartInstance = effortDistributionChartInstance = epicsStatusChartInstance = runCausesChartInstance = null;
            }

            nav.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (button) {
                    const targetId = button.getAttribute('data-target');
                    buttons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    sections.forEach(section => {
                        section.classList.toggle('active', section.id === targetId);
                    });
                    
                    destroyCharts(); // Destroy all charts on tab change

                    if (targetId === 'release') {
                        createBurndownChart();
                    } else if (targetId === 'overview') {
                        createMttrChart();
                        createOverviewDeploymentsChart();
                    } else if (targetId === 'history') {
                        updateSprintView(sprintSelect.value, sprintData);
                    }
                }
            });

            document.querySelectorAll('.progress-bar').forEach(bar => {
                const progress = bar.getAttribute('data-progress');
                bar.style.width = progress + '%';
            });

            function createBurndownChart() {
                const ctx = document.getElementById('burndownChart')?.getContext('2d');
                if (!ctx) return;
                burndownChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Start', 'W1', 'W2', 'W3', 'W4', 'W5', 'W6'],
                        datasets: [
                            {
                                label: 'Ideal',
                                data: [310, 258, 206, 155, 103, 52, 0],
                                borderColor: '#10b981',
                                fill: false,
                                tension: 0.2,
                                pointRadius: 0
                            },
                            {
                                label: 'Actual',
                                data: [310, 270, 220, 170, 120, 80, 40],
                                borderColor: '#4f46e5',
                                backgroundColor: '#6366f1',
                                fill: false,
                                tension: 0.2,
                                pointRadius: 4,
                                pointBackgroundColor: '#4f46e5'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: true } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Story Points' } },
                            x: { title: { display: true, text: 'Week' } }
                        }
                    }
                });
            }

            function createMttrChart() {
                const ctx = document.getElementById('mttrChart')?.getContext('2d');
                if (!ctx) return;
                mttrChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['DBA-2025SP32', 'DBA-2025SP33', 'DBA-2025SP34', 'DBA-2025SP35', 'DBA-2526SP1'],
                        datasets: [
                            {
                                label: 'Average Story Points - DBA',
                                data: [88, 98, 73, 89.5, 50.5],
                                backgroundColor: '#4f46e5'
                            },
                            {
                                label: 'Story Points Team Z',
                                data: [22, 45, 27, 33, 32],
                                backgroundColor: '#10b981'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { x: { stacked: true }, y: { beginAtZero: true, suggestedMax: 120, stacked: true } },
                        plugins: { legend: { display: true } }
                    }
                });
            }

            function createOverviewDeploymentsChart() {
                const ctx = document.getElementById('deploymentsChart_overview')?.getContext('2d');
                if(!ctx) return;
                overviewDeploymentsChartInstance = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Build', 'Run'],
                        datasets: [{
                            label: 'Build & Run',
                            data: [74, 26],
                            backgroundColor: ['#4f46e5', '#10b981']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: true } }
                    }
                });
            }

            function createEffortDistributionChart(effortData) {
                const ctx = document.getElementById('effortDistributionChart')?.getContext('2d');
                if (!ctx) return;
                effortDistributionChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Build', 'Develop', 'Refine'],
                        datasets: [{
                            label: 'Effort Distribution',
                            data: Object.values(effortData),
                            backgroundColor: ['#4f46e5', '#f59e0b', '#10b981'],
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true }
                        }
                    }
                });
            }

            function createEpicsStatusChart(epicsData) {
                const ctx = document.getElementById('epicsStatusChart')?.getContext('2d');
                if (!ctx) return;

                const epicLabels = Object.keys(epicsData);
                const statusKeys = ["Done", "Done in Sprint", "Pending", "Dropped"];
                const statusColors = {
                    "Done": "#4f46e5",
                    "Done in Sprint": "#f59e0b",
                    "Pending": "#facc15",
                    "Dropped": "#ef4444"
                };

                const datasets = statusKeys.map(status => ({
                    label: status,
                    data: epicLabels.map(epic => epicsData[epic][status] || 0),
                    backgroundColor: statusColors[status]
                }));

                epicsStatusChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: epicLabels,
                        datasets: datasets
                    },
                    options: {
                        indexAxis: 'y', // <-- horizontal bars
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                        },
                        scales: {
                            x: {
                                stacked: true,
                                title: { display: true, text: 'Story Count' },
                                beginAtZero: true
                            },
                            y: {
                                stacked: true,
                                title: { display: true, text: 'Epic' },
                                ticks: {
                                  autoSkip: false,
                                  maxRotation: 0,
                                  minRotation: 0
                                }
                            }
                        }
                    }
                });
            }

            function createRunCausesChart(runCausesData) {
                const ctx = document.getElementById('runCausesChart')?.getContext('2d');
                if (!ctx) return;
                runCausesChartInstance = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(runCausesData).map(key => key.replace(/([A-Z])/g, ' $1').trim()), // Add spaces for readability
                        datasets: [{
                            label: 'Count',
                            data: Object.values(runCausesData),
                            backgroundColor: ['#ef4444', '#f59e0b', '#facc15', '#4f46e5'],
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        }
                    }
                });
            }

            function updateSprintView(sprintId, data) {
                const sprintMetrics = data[sprintId];
                if (!sprintMetrics) return;

                // Destroy existing history charts before creating new ones
                if (effortDistributionChartInstance) effortDistributionChartInstance.destroy();
                if (epicsStatusChartInstance) epicsStatusChartInstance.destroy();
                if (runCausesChartInstance) runCausesChartInstance.destroy();

                // Update metric cards
                document.getElementById('build-metric').textContent = sprintMetrics.effort.build + '%';
                document.getElementById('run-metric').textContent = sprintMetrics.effort.develop + '%';
                document.getElementById('refine-metric').textContent = sprintMetrics.effort.refine + '%';

                // Create the 3 charts for the section
                createEffortDistributionChart(sprintMetrics.effort);
                createEpicsStatusChart(sprintMetrics.epics);
                createRunCausesChart(sprintMetrics.run_causes);
            }

            function initializeHistorySection() {
                const sprints = Object.keys(sprintData);

                sprintSelect.innerHTML = '';
                sprints.forEach(sprint => {
                    const option = document.createElement('option');
                    option.value = sprint;
                    option.textContent = sprint;
                    sprintSelect.appendChild(option);
                });

                sprintSelect.addEventListener('change', (e) => {
                    updateSprintView(e.target.value, sprintData);
                });

                if (document.querySelector('.content-section.active')?.id === 'history') {
                    updateSprintView(sprintSelect.value, sprintData);
                }
            }

            // Initial setup
            initializeHistorySection();
            createBurndownChart(); // Create the chart for the initially active tab
        });
    </script>
    
</body>
</html>